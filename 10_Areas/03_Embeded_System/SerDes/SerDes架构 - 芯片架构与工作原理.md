---
tags:
  - "#domain/embedded"
  - "#type/knowledge"
  - "#level/intermediate"
  - "#tech/serdes"
status: 完善中
complexity: 中级
notetype: 学习笔记
resource: SerDes技术文档
related:
  - "[[00_SerDes_MOC]]"
  - "[[SerDes基础 - 并行与串行数据传输]]"
  - "[[SerDes技术 - Tx发送器模块]]"
  - "[[SerDes技术 - Rx接收器模块]]"
created: 2025-11-18 22:00:00
modified: 2025-11-18 22:00:00
---
# SerDes架构 - 芯片架构与工作原理

> [!abstract] 摘要
> 本笔记介绍SerDes芯片的整体架构设计,包括串行器、解串器、时钟管理、信号调节等核心模块的组成和工作原理。

## 🎯 Target
- [ ] 理解SerDes芯片的整体架构
- [ ] 掌握Serializer和Deserializer的工作原理
- [ ] 了解SerDes的设计目标和关键技术
- [ ] 理解各功能模块的作用和相互关系

## 📝 Core

### SerDes架构概述

#### 定义与目标
SerDes(Serializer/Deserializer)是高速数据通信中的核心技术,其主要目的是在不同设备或芯片之间实现**高速、长距离**的数据传输。

**设计目标:**
- ✅ **高数据速率传输** - 支持多Gbps甚至Tbps的数据传输速率
- ✅ **低功耗** - 优化功耗以适应现代通信和计算需求
- ✅ **低误码率(BER)** - 保证传输的准确性和稳定性(通常要求BER < 10⁻¹²)
- ✅ **协议兼容性** - 支持多种通信协议标准

#### 核心组成

SerDes芯片架构主要由两部分组成:

**1. Serializer (串行器)**
- 负责将并行数据转换为串行数据流
- 主要用于减少传输通道的数量,从而降低硬件成本和复杂性

**2. Deserializer (解串器)**
- 负责将接收到的串行数据流还原为并行数据
- 主要用于支持下游设备或芯片的进一步处理

### SerDes的主要工作

#### 1. 高速数据传输
- 在设备(如CPU、GPU、存储设备、通信设备)之间传输数据
- 应用于PCIe、以太网、USB、HDMI等协议中

**应用示例:**
```
CPU <--SerDes--> GPU    (PCIe)
存储 <--SerDes--> 主板  (SATA/NVMe)
交换机 <--SerDes--> 网卡 (Ethernet)
```

#### 2. 信号完整性与误码控制
在高速传输中,信号容易受到:
- 📉 **噪声** - 热噪声、耦合噪声
- 📉 **串扰** - 相邻信号线之间的干扰
- 📉 **信号衰减** - 传输距离导致的能量损失

SerDes通过架构设计,提升信号完整性,降低误码率:
- 使用**均衡器**补偿信号失真
- 使用**CDR**恢复时钟和采样数据
- 使用**差分信号**提高抗干扰能力

#### 3. 节约硬件资源
- 通过串行化技术减少传输所需的物理通道数,降低成本
- 在布线复杂的高速PCB设计中,SerDes尤为重要

**成本对比:**
| 传输方式 | 数据位宽 | 信号线数 | PCB层数 | 连接器成本 |
|---------|---------|---------|---------|-----------|
| 并行32位 | 32      | 32+     | 8-12层  | 高        |
| SerDes  | 32      | 2(差分) | 4-6层   | 低        |

#### 4. 支持多种通信协议
SerDes芯片通常需要兼容不同的通信协议:
- **PCIe** - PCI Express (Gen1~Gen6: 2.5Gbps~64Gbps)
- **以太网** - 1G/10G/25G/100G Ethernet
- **SATA** - Serial ATA (1.5/3/6 Gbps)
- **DisplayPort** - 视频传输协议
- **USB** - Universal Serial Bus (USB 3.x/4.x)

### SerDes架构核心模块

#### 模块1: 串行器部分 (Serializer / Tx)

**工作原理:**
1. 接收来自上游设备的多路并行数据
2. 通过**多路复用器(Multiplexer, MUX)**合并成一条高速串行数据流
3. 经过**均衡器和驱动器**发送到传输通道

**关键技术:**
- **时钟多路复用** - 利用高频时钟将低速并行数据编码到高速串行通道中
- **编码技术** - 如8b/10b或64b/66b编码,确保DC平衡和时钟恢复

**示例:**
```
8位并行数据 @ 1GHz  →  串行化  →  8Gbps串行数据流

并行输入:  D7 D6 D5 D4 D3 D2 D1 D0
           ↓  ↓  ↓  ↓  ↓  ↓  ↓  ↓
          [  Parallel to Serial  ]
                    ↓
串行输出:  D7 D6 D5 D4 D3 D2 D1 D0 → (逐位发送)
```

#### 模块2: 解串器部分 (Deserializer / Rx)

**工作原理:**
1. 接收来自串行通道的高速数据流
2. 通过**时钟数据恢复(CDR)**提取时钟并采样数据
3. 通过**多路分解器(Demultiplexer, DEMUX)**将串行数据恢复为并行数据

**关键技术:**
- **时钟数据恢复(CDR)**
  - 从接收到的串行数据中提取嵌入的时钟信号
  - 锁定数据边沿,找到最佳采样点

- **均衡器**
  - 补偿信号在传输过程中的衰减,恢复原始波形
  - 包括前馈均衡(FFE)、决策反馈均衡(DFE)等

**示例:**
```
串行输入: D7 D6 D5 D4 D3 D2 D1 D0 → (逐位接收)
                ↓
          [ Serial to Parallel ]
                ↓  ↓  ↓  ↓  ↓  ↓  ↓  ↓
并行输出: D7 D6 D5 D4 D3 D2 D1 D0
```

#### 模块3: 时钟管理模块

**锁相环 (Phase-Locked Loop, PLL)**
- 生成高精度的时钟信号
- 为串行化和解串化提供稳定的频率
- 支持时钟倍频和分频

**时钟恢复模块 (CDR)**
- 在接收端从数据流中提取时钟信号
- 保持发送端和接收端的同步
- 跟踪时钟相位和频率变化

> [!important] SerDes的自同步特性
> SerDes和一般传输不一样的地方在于,SerDes**没有单独的时钟信号**,时钟信号并入数据信号一起传输。
> - **优点**: 减去了时钟线,不会有时钟边缘和数据中心不对齐的现象
> - **技术**: 使用CDR从数据边沿恢复时钟,实现自同步

#### 模块4: 信号调节与均衡模块

**前馈均衡器 (FFE - Feed-Forward Equalizer)**
- 在发送端用于预先补偿信号失真
- 类似FIR滤波器,有多个tap(抽头)
- 通过调整tap系数来预加重高频分量

**决策反馈均衡器 (DFE - Decision Feedback Equalizer)**
- 在接收端实时校正信号中的噪声和失真
- 利用已判决的数据消除ISI(码间干扰)
- 只对已知的干扰做补偿

**连续时间线性均衡器 (CTLE)**
- 模拟均衡器,在接收端使用
- 通过放大高频成分来补偿通道的低通特性
- 简单但会放大高频噪声

#### 模块5: 接口与协议适配

SerDes通常集成**协议栈**,以支持各种行业标准协议:
- **物理层(PHY)** - SerDes核心功能
- **数据链路层(DLL)** - 帧同步、差错控制
- **事务层** - 协议相关的数据包处理

### SerDes的三大核心模块

#### 1. Tx (Transmitter) - 发送器
**功能**: 并行转串行

**组成:**
- FIFO缓存
- 编码器(Encoder)
- 扰码器(Scrambler)
- 均衡器(Equalizer)
- 差分驱动器(Driver)

#### 2. Rx (Receiver) - 接收器
**功能**: 串行转并行

**组成:**
- 差分接收器
- 均衡器(CTLE/DFE)
- CDR(时钟数据恢复)
- 解扰器(Descrambler)
- 解码器(Decoder)
- FIFO缓存

#### 3. PLL (Phase-Locked Loop) - 锁相环
**功能**: 时钟管理

**作用:**
- 生成高速串行时钟
- 提供参考时钟
- 支持分频和倍频

### SerDes与PHY层的关系

SerDes本质上是**PHY层器件**,工作在OSI模型的物理层。

#### OSI七层模型
```
┌─────────────────┐
│  应用层(7)      │
├─────────────────┤
│  表示层(6)      │
├─────────────────┤
│  会话层(5)      │
├─────────────────┤
│  传输层(4)      │
├─────────────────┤
│  网络层(3)      │
├─────────────────┤
│  数据链路层(2)  │  ← MAC层
├─────────────────┤
│  物理层(1)      │  ← SerDes/PHY层
└─────────────────┘
```

#### 物理层(PHY)的功能
- 🔧 **物理编码子层(PCS)** - 8b/10b编码、扰码
- 🔧 **物理介质连接子层** - 并串转换(SerDes核心)
- 🔧 **物理介质相关子层(PMA)** - 均衡器、CDR、驱动器
- 🔧 **自动协商子层** - 速率协商、参数配置

**接口:**
- **MII (Media Independent Interface)** - 物理层与数据链路层的接口
- **MDI (Media Dependent Interface)** - 物理层与传输介质的接口

> [!example] SerDes应用协议
> 常见的通信协议,例如**PCIe、NVLink、SATA、USB**等都是基于SerDes的协议,因此SerDes更接近于**物理层(PHY层)**。

---
## 🤔 Q&A

### Q1: SerDes为什么需要编码(如8b/10b)?
**A**: 编码有多个目的:
1. **DC平衡** - 确保0和1数量相近,避免直流偏移
2. **时钟恢复** - 保证足够的边沿跳变供CDR使用
3. **控制字符** - 提供特殊字符用于帧同步和控制
4. **错误检测** - 某些编码具有错误检测能力

### Q2: 为什么高速SerDes需要均衡器?
**A**: 因为**传输通道具有频率选择性**,高频成分衰减更严重,导致:
- 信号上升/下降沿变缓
- 码间干扰(ISI)
- 眼图闭合
均衡器通过补偿不同频率的衰减差异,恢复信号完整性。

### Q3: CDR如何从数据中恢复时钟?
**A**: CDR通过检测数据的**边沿跳变**来恢复时钟:
1. 检测数据的0→1或1→0跳变
2. 使用PLL/DLL锁定跳变频率
3. 调整采样时钟的相位,找到最佳采样点
4. 持续跟踪和调整,适应时钟漂移

### Q4: SerDes的速率可以达到多少?
**A**: 取决于具体应用和工艺:
- **低速SerDes**: 1-5 Gbps (USB 3.0, SATA)
- **中速SerDes**: 10-28 Gbps (PCIe Gen4, 25G Ethernet)
- **高速SerDes**: 56-112 Gbps (PCIe Gen6, 100G/400G Ethernet)
- **超高速SerDes**: >200 Gbps (研发中)

## 🚀 Tasks
- [ ] 绘制完整的SerDes架构框图
- [ ] 对比不同编码方式(8b/10b vs 64b/66b)的优缺点
- [ ] 研究一个实际SerDes芯片的性能参数
- [ ] 理解眼图和如何使用眼图评估SerDes性能

## 📚 Reference
* High-Speed SerDes Devices and Applications
* PCI Express Base Specification
* IEEE 802.3 Ethernet Standards
* Xilinx/Intel FPGA SerDes User Guide

## 🕸️ Relation
* 这篇笔记是[[00_SerDes_MOC|SerDes知识体系]]的核心部分
* [[SerDes基础 - 并行与串行数据传输]] - 理解SerDes存在的必要性
* [[SerDes技术 - Tx发送器模块]] - 详细了解发送器的实现
* [[SerDes技术 - Rx接收器模块]] - 详细了解接收器的实现
* [[SerDes技术 - 时钟与同步]] - 深入理解CDR和PLL
* [[SerDes技术 - 均衡器与信号完整性]] - 深入理解均衡技术
